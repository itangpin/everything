/*! Everything 2015-04-20 */
define(["everything","toolbar","event","editor"],function(a,b,c,d){var e={};return e.status={editor:{launched:!1},list:{}},e.init=function(){this.eventMgr=new c,this.toolbar=new b({container:"#toolbar",switcherEl:[{button:"#writing-btn",panel:"#panel-writing",name:"writing"},{button:"#list-btn",panel:"#container",name:"list"},{button:"#setting-btn",panel:"#panel-setting",name:"setting"}],panelClass:".panel",buttonClass:".button",eventMgr:this.eventMgr}),this.editor=new d({titleEl:$(".editor-title")[0],contentEl:$(".editor-content")[0]}),this.status.editor.launched=!0,this.listenEvents()},e.listenEvents=function(){var a=this;this.eventMgr.addListener("panelChange",function(b){"writing"==b.panel&&a.editor.onPanelActive(b)})},e.launchEditorFromNode=function(a){},e}),define([],function(){var a=function(a){this.el={titleEl:a.titleEl,contentEl:a.contentEl},this.status={editorInstantiated:!1},this.init()};return a.prototype.init=function(){},a.prototype.launchEditor=function(a){var b=function(a,b,c){var d={theme:c||"xq-light-big",tabSize:4,lineNumbers:!1,lineWrapping:!0,autoCloseBrackets:!0,extraKeys:this.keyMaps,mode:{name:"markdown",underscoresBreakWords:!1,taskLists:!0,fencedCodeBlocks:!0},value:b||"",placeholder:"content"};return new CodeMirror(a,d)};this.editor=b(this.el.contentEl,a,null),this.status.editorInstantiated=!0},a.prototype.onPanelActive=function(a){"toolbar"!=a.from||this.status.editorInstantiated||this.launchEditor()},a.prototype.launchEditorFromNode=function(a){this.status.editorInstantiated&&this.save();a.getValue()},a}),define(function(){function a(){this._listeners={}}return a.prototype={addListener:function(a,b){return(this._listeners[a]=this._listeners[a]||[]).push(b),this},removeListener:function(a,b){if(1===arguments.length)this._listeners[a]=[];else if("function"==typeof b){var c=this._listeners[a];if(void 0!==c){for(var d=-1,e=0,f=c.length;f>e&&-1===d;e++)c[e]===b&&(d=e);d>=0&&c.splice(d,1)}}return this},fire:function(b,c,d){var e=this._listeners[b];if(c=c||[],Array.isArray(c)||(c=[c]),void 0!==e)for(var f,g={},h=0,i=e.length;i>h&&(f=new a.EventArg(b,g),e[h].apply(d||window,c.concat(f)),g=f.data,f.removed&&(e.splice(h,1),i=e.length,--h),!f.cancelled);h++);return this},hasListeners:function(a){return(void 0===this._listeners[a]?0:this._listeners[a].length)>0}},a.eventify=function(b,c){var d=a.eventify.methods;c=c||new a;for(var e=0,f=d.length;f>e;e++)(function(a){b[a]=function(){return c[a].apply(c,arguments)}})(d[e]);return c},a.eventify.methods=["addListener","removeListener","fire"],a.EventArg=function(a,b){this.name=a,this.data=b,this.cancelled=!1,this.removed=!1},a.EventArg.prototype={cancel:function(){this.cancelled=!0},remove:function(){this.removed=!0}},a}),define(["node","history","package","event","saver","packages/editor","packages/highlight"],function(a,b,c,d,e,f,g){var h=function(a,d,e){this.data=a,this.app=d,this.index=0,this.packages=[],e.container||this.createContainer(),this.frame=e.container,$(this.frame).on("click",function(){console.log("frame")}),this.themes=["dark","light"],this.theme=e.theme?e.theme:"light",$(this.frame).addClass(this.theme),$(document.body).addClass(this.theme),this.history=new b,this.packageMgr=new c(this),this.init(),this.initPackages(),this.creating=!0,this._create(a),this.creating=!1,this.mode="insert"};h.prototype.init=function(){var a=this;this.eventMgr=new d,this.packageEventsMgr=new d,this.crumb=new i(this),this.saver=new e(this),this.eventMgr.addListener("rootNodeChange",this.onRootNodeChange),this.eventMgr.addListener("valueChange",this.onValueChange),this.appEvents=["contentChange"],this.appEventsHandler={},this.appEvents.forEach(function(b){a.appEventsHandler[b]=[]})},h.prototype._getValue=function(a){return"current"==a?this.rootNode.getValue():"root"==a?this.veryRootNode.getValue():void 0},h.prototype.getRootValue=function(){return this._getValue("root")},h.prototype.getCurentValue=function(){return this._getValue("current")},h.prototype.onValueChange=function(){this.saver.save()},h.prototype.createContainer=function(){},h.prototype._create=function(b){var c=this,d=new a(b,c);d.adjustDom({type:"append",el:this.frame}),d.setRoot(),this.rootNode=d,this.veryRootNode=d;var e=function(a){c.onEvent(a)},f=["click","keydown","propertychange","keyup","paste","cut"];$.each(f,function(a,b){"focus"==b?c.frame.addEventListener(b,e,!0):c.frame.addEventListener(b,e)}),c.frame.addEventListener("input",c.event("input"))},h.prototype.event=function(b){var c=this;return"input"==b?function(b){var d=a.getNodeFromTarget(b.target);d&&(d.onEvent(b),c.appEventsHandler.contentChange.forEach(function(a){a(d)}))}:void 0},h.prototype._createToolBar=function(){var a=this,b=document.createElement("div");b.className="toolbar",this.toobarElement=b,document.body.appendChild(b);var c=["theme"];this.buttons={},c.forEach(function(b,c){var d=document.createElement("button");d.className=b,d.innerHTML=b,a.buttons[b]=d,a.toobarElement.appendChild(d)});var d=crel("button",{"class":"new-article"},"New Article"),e=crel("div",{"class":"button-wrapper"},d);b.appendChild(e)},h.prototype._createTitle=function(a){var b=a.getContent();if(a==this.veryRootNode)return this.frame.removeChild(this.titleElement),void(this.titleElement=void 0);if(this.titleElement)this.titleText=b,this.titleElement.innerText=b;else{var c=document.createElement("div");c.innerHTML=b,c.setAttribute("contentEditable",!0),c.className+="rootnode-title",this.titleElement=c,$(this.frame).children()?$(this.frame).children().first().before(c):this.frame.appendChild(c)}},h.prototype._createAddButton=function(){var a=this,b=this,c=document.createElement("a");c.innerHTML="Add a child",c.setAttribute("href","#");var d=document.createElement("a");d.setAttribute("href","#"),d.innerHTML="Edit";var e=document.createElement("div");e.classList.add("add-wrapper"),e.appendChild(c),e.appendChild(d),this.addBtnWrapper=e,this.frame.appendChild(e),$(c).on("click",function(){a.rootNode._createChild({}),a.addBtnWrapper&&a.frame.removeChild(e)}),$(d).on("click",function(){b.app.launchEditorFromNode(b.rootNode)})},h.prototype.initPackages=function(){this.packageMgr.add("editor",f),this.packages.push("editor"),this.packageMgr.add("highlight",g),this.packages.push("highlight")},h.prototype.getPackages=function(){var a=[],b=this;return this.packages.forEach(function(c){a.push(b.packageMgr.get(c))}),a},h.prototype.switchRootNodeWithPackage=function(b){var c=this.rootNode.getValue();c["package"]=b;var d=new a(c,this);d.setParent(this.rootNode.parent),this.zoomIn(d,!0),-1!=b.indexOf("editor")&&d.launchEditor()},h.prototype.onEvent=function(b){if("move"==this.mode?("keydown"==b.type||"focus"==b.type)&&(this.move(b),console.log("keydown")):"insert"==this.mode,27==b.keyCode&&this.setMode("move"),"click"==b.type&&b.target==this.bread,"keyup"==b.type);var c=a.getNodeFromTarget(b.target);c&&c.onEvent(b)},h.prototype.onAction=function(a,b){if("zoomin"==a){var c=b.node;if(!c)return;this.zoomIn(c)}"valueChange"==a&&b.node==this.veryRootNode&&this.eventMgr.fire("valueChange",null,this),this.history&&this.history.add(a,b)},h.prototype.onRootNodeChange=function(a){a==this.veryRootNode?this.crumb.hide():this.crumb.render(),this.addBtnWrapper&&(this.frame.removeChild(this.addBtnWrapper),this.addBtnWrapper=void 0)},h.prototype.zoomIn=function(a,b){this.creating=!0;var c=a;c&&(this.frame.removeChild(this.rootNode.row),c.refreshDom(),c.setRoot(),c.adjustDom({type:"append",el:this.frame}),this.rootNode=c,this._createTitle(this.rootNode),this.eventMgr.fire("rootNodeChange",this.rootNode,this),(b===!1||void 0==b&&!this.rootNode.hasChild())&&this._createAddButton(),this.creating=!1)},h.prototype.toggleTheme=function(){var a=this.themes.indexOf(this.theme);console.log(a);var a=a+2>this.themes.length?0:a+1,b=this.theme;this.theme=this.themes[a],$(this.frame).removeClass(b).addClass(this.theme),$(document.body).removeClass(b).addClass(this.theme),this.eventMgr.fire("themeChange",[this.theme])},h.prototype.setMode=function(a){var b=this.mode;this.mode=a,("insert"==b||"move"==this.mode)&&(this.curentNode.highlight(),this.curentNode.row.setAttribute("contentEditable","false"))},h.prototype.setCurentNode=function(a){var b=this.curentNode;this.curentNode=a,"move"==this.mode&&(b.noHighlight(),a.highlight())},h.prototype.move=function(a){return a.preventDefault(),74==a.keyCode&&this.moveNext(),75==a.keyCode&&this.movePrev(),!1},h.prototype.moveNext=function(){this.index++,2==this.index&&console.log(this.curentNode);var a=this.curentNode;if(a){var b;b=a.hasChild()?a.childs[0]:a.getRelativeNode("after"),a.noHighlight(),b.highlight(),this.curentNode=b,console.log("c"+a.getContent()+";;;n"+b.getContent())}else this.moveToFirst()},h.prototype.movePrev=function(){},h.prototype.moveToFirst=function(){if(this.rootNode&&this.rootNode.hasChild()){var a=this.rootNode.childs[0];this.setCurentNode(a),a.highlight()}},h.prototype.moveToLast=function(){},h.prototype.on=function(a,b){var c=["contentChange"];-1!=c.indexOf(a)&&this.appEventsHandler[a].push(b)};var i=function(a){a&&(this.app=a)};return i.prototype.getDom=function(a){var b=this.app,c=[];return a.forEach(function(a,d){var e=a.getContent();a==b.veryRootNode?e="Home":""==a.getContent()&&(e="noname");var f=crel("div",{"class":"crumb-link"},crel("a",{href:"#"+a.id},e),">");c.push(f)}),c},i.prototype.render=function(){var a=this.app,b=this;if(a.crumbElement){a.crumbElement.innerHTML="";var c=this.app.rootNode.getPath(),d=this.getDom(c);d.forEach(function(c,d){a.crumbElement.appendChild(c),$(c).find("a").on("click",function(){b.onEvent($(this))})})}else a.crumbElement=crel("div",{"class":"crumb"}),$(a.frame).children()?$(a.frame).children().first().before(a.crumbElement):a.frame.appendChild(a.crumbElement),this.render()},i.prototype.hide=function(){var a=this.app;a.crumbElement&&(a.frame.removeChild(a.crumbElement),a.crumbElement=void 0)},i.prototype.onEvent=function(a){for(var b,c=this.app,d=a.attr("href").slice(1),e=c.rootNode.parent;e;){if(e.id==d){b=e;break}e=e.parent}c.zoomIn(b)},i.prototype.onRootNodeChange=function(a,b){a==ths.app.veryRootNode&&this.hide(),this.render()},h}),define(function(){function a(a){this.app=a,this.clear(),this.actions={editField:{undo:function(a){a.node.updateField(a.oldValue)},redo:function(a){a.node.updateField(a.newValue)}},editValue:{undo:function(a){a.node.updateValue(a.oldValue)},redo:function(a){a.node.updateValue(a.newValue)}},appendNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.appendChild(a.node)}},insertBeforeNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertBefore(a.node,a.beforeNode)}},insertAfterNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertAfter(a.node,a.afterNode)}},removeNode:{undo:function(a){var b=a.parent,c=b.childs[a.index]||b.append;b.insertBefore(a.node,c)},redo:function(a){a.parent.removeChild(a.node)}},duplicateNode:{undo:function(a){a.parent.removeChild(a.clone)},redo:function(a){a.parent.insertAfter(a.clone,a.node)}},changeType:{undo:function(a){a.node.changeType(a.oldType)},redo:function(a){a.node.changeType(a.newType)}},moveNode:{undo:function(a){a.startParent.moveTo(a.node,a.startIndex)},redo:function(a){a.endParent.moveTo(a.node,a.endIndex)}},sort:{undo:function(a){var b=a.node;b.hideChilds(),b.sort=a.oldSort,b.childs=a.oldChilds,b.showChilds()},redo:function(a){var b=a.node;b.hideChilds(),b.sort=a.newSort,b.childs=a.newChilds,b.showChilds()}}}}return a.prototype.onChange=function(){},a.prototype.add=function(a,b){this.index++,this.history[this.index]={action:a,params:b,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()},a.prototype.clear=function(){this.history=[],this.index=-1,this.onChange()},a.prototype.canUndo=function(){return this.index>=0},a.prototype.canRedo=function(){return this.index<this.history.length-1},a.prototype.undo=function(){if(this.canUndo()){var a=this.history[this.index];if(a){var b=this.actions[a.action];b&&b.undo?(b.undo(a.params),a.params.oldSelection&&this.editor.setSelection(a.params.oldSelection)):console.log('Error: unknown action "'+a.action+'"')}this.index--,this.onChange()}},a.prototype.redo=function(){if(this.canRedo()){this.index++;var a=this.history[this.index];if(a){var b=this.actions[a.action];b&&b.redo?(b.redo(a.params),a.params.newSelection&&this.editor.setSelection(a.params.newSelection)):util.log('Error: unknown action "'+a.action+'"')}this.onChange()}},a}),requirejs.config({path:{codeMirror:"../spm_modules/codemirror/codemirror.js",Everything:"everything.js"}}),require(["Everything","./editor","app"],function(a,b,c){$(function(){var b=[{content:"写作",children:[]},"Version 0.5.1",{content:"功能用法",children:["创建新的一行(Enter键)","向右缩进(Tab键)",{content:"删除一行",children:["delete键","在空行上按退格键"]},{content:"文本编辑器","package":["editor"]}],expand:!1},{content:"新增功能",children:["主题切换","切换根节点"]},{content:"新特性：编辑器，包管理。在这行上按Alt+O",detail:"#标题\n\n*italic*\n\n**加粗**普通","package":["editor"]}];localStorage.getItem("value")&&(b=JSON.parse(localStorage.getItem("value")));var d=document.querySelector(".everything");$(function(){c.init(),$(".new-article").on("click",function(){$("#container").hide(),$(".editor-container").show()});new a(b,app,{container:d,theme:"light"})})})}),define(["util"],function(a){var b=function(b,c){this.value=b,this.formatValue(),this.app=c,this.childs=[],this.childrenMap={},this.isRootNode=!1,this.id=a.uuid(),this.app.packages.length>0&&this.initPackages(),this._createDom(),this.getPath(),this.highlighted=!1};return b.getNodeFromTarget=function(a){for(;a;){if(a.node)return a.node;a=a.parentNode}return void 0},b.prototype._updateDomIndexes=function(){var a=this.childs;a.length&&a.forEach(function(a,b){a.index=b,a.row.setAttribute("childIndex",b)})},b.prototype.refreshPath=function(){this.path=[];for(var a=this;a;)a.parent&&this.path.unshift(a.parent),a=a.parent},b.prototype.getPath=function(){return this.refreshPath(),this.path},b.prototype._createDom=function(){var a=crel("a",{"class":"dot"},crel("span",{"class":"b"},crel("span",{"class":"s"}))),b=crel("div",{"class":"project-content",contentEditable:!0}),c=crel("div",{"class":"children"}),d=crel("div",{"class":"project",projectId:this.id},a,b,c);d.node=this,this.buttonElement=a,this.contentElement=b,this.childrenElement=c,this.row=d,this.setValue(),this._onDomReady()},b.prototype.refreshDom=function(){this.childs=[],this.childrenMap={},this._createDom()},b.prototype.adjustDom=function(a){function b(a){$(a).after(d.row)}function c(a){$(a).append(d.row)}var d=this;if(a)switch(a.type){case"after":b(a.el);break;case"append":c(a.el)}else this.parent.appendChild(this.row),z},b.prototype.onEvent=function(a){var b=a.type,c=a.target||a.srcElement;if("keydown"==b){var d=a.keyCode;if(13==d&&a.ctrlKey)return a.preventDefault(),this.createSiblingNodeAfter(),!1;if(13==d&&a.shiftKey)return a.preventDefault(),this._onInsertBefore({}),!1;if(9==a.keyCode)return a.preventDefault(),a.shiftKey?this.unindent():this.indent(),!1;if(46==a.keyCode)return a.preventDefault(),this.parent.removeChildAndDom(this),!1;8==a.keyCode&&""==this.getContent()&&this.parent.removeChildAndDom(this),"move"==this.app.mode}"click"==b&&((c==this.buttonElement||c==this.buttonElement.childNodes[0]||c==this.buttonElement.childNodes[0].childNodes[0])&&(a.altKey?this.collapse():this._onZoomIn()),c==this.contentElement&&this.app.setCurentNode(this)),("keyup"==b||"paste"==b||"cut"==b)&&this.onValueChange(),"input"==a.type&&this.onValueChange(),this.packageEventsHandle(a)},b.prototype.packageEventsHandle=function(a){var b=this;this.packageEvents&&this.packageEvents.length&&$.each(this.packageEvents,function(c,d){d.call(b,a)})},b.prototype.initPackages=function(){var a=this;this.packageEvents=this.packageEvents||[],this.packages=this.app.getPackages(),this.value.packageValue=this.value.packageValue||{},$.each(this.packages,function(b,c){c.node&&$.extend(a,c.node),c.onEvent&&a.packageEvents.push(c.onEvent)})},b.prototype.onValueChange=function(){this.app.creating||(this.updateValue(),this.parent&&this.parent.onValueChange(),this.app.onAction("valueChange",{node:this}))},b.prototype.updateValue=function(){this.value=this.getValue()},b.prototype.getValue=function(){var a=this;return this.value.content=this.contentElement.innerHTML,this.value.children=[],this.hasChild()&&this.childs.forEach(function(b){a.value.children.push(b.getValue())}),this.value},b.prototype.formatValue=function(){return Array.isArray(this.value)?(this.value={content:"",children:this.value,packageValue:{}},this.value):(("string"==typeof this.value||this.value.constructor==String)&&(this.value={content:this.value,children:[],packageValue:{}}),this.value.content||(this.value.content=""),void(this.value.children||(this.value.children=[])))},b.prototype.setValue=function(a){a&&(this.value=a,this.formatValue()),this.value?(this.setContent(this.value.content),this.setChildren(this.value.children)):this.setValue("")},b.prototype.setContent=function(a){("string"==typeof a||a.constructor==String)&&(this.content=a,this.contentElement.innerHTML=this.content,this.onValueChange())},b.prototype.setParent=function(a){this.parent=a},b.prototype.setChildren=function(a){var b=this;Array.isArray(a)&&a.length>0&&(a.forEach(function(a,c){b._createChild(a)}),this.row.className+=" hasChild")},b.prototype.getContent=function(){return this.content=this.contentElement.innerHTML,this.content},b.prototype.setRoot=function(){this.row.classList.add("root"),this.isRootNode=!0},b.prototype.getRelativeNode=function(a){switch(a){case"before":var b=this.row.previousSibling;if(b){var c=b.getAttribute("projectId");return this.parent.findChildById(c)}return null;case"after":if(this.parent){var d=this.parent.childs[this.index+1];return d?d:null}return null}},b.prototype.addSiblingNodeBefore=function(a){this.isRootNode||(a.isRootNode&&(a.isRootNode=!1),a.parent&&a.parent.removeChild(a),a.setParent(this.parent),this.parent._addChild(a),$(this.row).before(a.row),this.onValueChange(this.parent))},b.prototype.addSiblingNodeAfter=function(a){var b=this.getRelativeNode("after");null!=b?b.addSiblingNodeBefore(a):this.parent.appendChild(a),this.onValueChange(this.parent)},b.prototype.addChildNodeAtHead=function(a){},b.prototype.addChildNodeAtTail=function(){},b.prototype.createSiblingNodeAfter=function(){var a=new b({},this.app);a.setParent(this.parent),a.adjustDom({type:"after",el:this.row}),this.parent._addChild(a),a.focus(a.contentElement),this.onValueChange(this.parent)},b.prototype._createChild=function(a){var c=new b(a,this.app);c.setParent(this),c.adjustDom({type:"append",el:this.childrenElement}),c.index=this.childs.length,this._addChild(c),c.focus(c.contentElement),this.onValueChange(this.parent)},b.prototype.appendChild=function(a){this.childrenElement.appendChild(a.row),this._addChild(a),a.index=this.childs.length,this.onValueChange(this.parent)},b.prototype._addChild=function(a){this.childs.push(a),this.childrenMap[a.id]=a,this.onValueChange(this.parent)},b.prototype.removeChild=function(a){this.childrenMap[a.id];this.childs=this.childs.filter(function(b){return b.id!=a.id}),this.childrenMap[a.id]=void 0,this._updateDomIndexes(),this.onValueChange(this.parent)},b.prototype.removeChildAndDom=function(a){var b=this.childrenMap[a.id];b.row.parentNode&&b.row.parentNode.removeChild(b.row),this.removeChild(a)},b.prototype.hasChild=function(){return this.childs.length},b.prototype._onInsertBefore=function(a){var c=new b(a,this.app);c.setParent(null),this.addSiblingNodeBefore(c),c.focus(c.contentElement),this.onValueChange(this.parent)},b.prototype._onInsertAfter=function(a){var c=new b(a,this.app);c.setParent(null),this.addSiblingNodeAfter(c),c.focus(c),this.app.onAction("insertAfter",{node:c,afterNode:this,parent:this.parent}),this.onValueChange(this.parent)},b.prototype._onIndent=function(){var a=this.getRelativeNode("before");a&&(a.appendChild(this),this.setParent(a)),this.onValueChange(this.parent)},b.prototype._onUnshift=function(a){var c=new b(a,this.app);c.setParent(this),this.onValueChange(this.parent)},b.prototype._onZoomIn=function(){this.app.onAction("zoomin",{node:this})},b.prototype._onDomReady=function(){},b.prototype.focus=function(a){var b=document.createRange(),c=window.getSelection();a.innerHTML.length?(b.setStart(a,1),b.setEnd(a,1)):(b.setStart(a,0),b.setEnd(a,0)),c.removeAllRanges(),c.addRange(b),a.focus()},b.prototype.blur=function(){this.contentElement.blur()},b.prototype.indent=function(){if(this.row.previousSibling){var a=this.getRelativeNode("before");this.parent.removeChildAndDom(this),a.appendChild(this),this.parent=a,this.focus(this.contentElement)}this.onValueChange(this.parent)},b.prototype.unindent=function(){this.parent&&(this.parent.addSiblingNodeAfter(this),this.onValueChange(this.parent))},b.prototype.getPrevNode=function(){if(this.prevNodeElement&&this.prevNode)return{el:this.prevNodeElement,node:this.prevNode};if(this.row.previousSibling){this.prevNodeElement=this.row.previousSibling;var a=this.prevNodeElement.getAttribute("projectId");return this.prevNode=this.parent.findChildById(a),this.getPrevNode()}return!1},b.prototype.collapseAnimating=!1,b.prototype.collapse=function(a){if(!this.collapseAnimating&&(this.collapseAnimating=!0,this.hasChild())){var b=this;$(this.childrenElement).hasClass("collapse")?($(b.row).removeClass("collapse"),$(this.childrenElement).animate({height:this.childrenHeight},200,function(){$(this).removeClass("collapse"),$(this).removeAttr("style"),b.collapseAnimating=!1})):(this.childrenHeight=$(this.childrenElement).height(),$(b.row).addClass("collapse"),$(this.childrenElement).animate({height:0},200,function(){$(this).addClass("collapse"),b.collapseAnimating=!1}))}},b.prototype.expand=function(){},b.prototype._destroy=function(){},b.prototype.findChildById=function(a){return this.childrenMap[a]},b.prototype.highlight=function(){this.highlighted=!0,this.contentElement.classList.add("highlight")},b.prototype.noHighlight=function(){this.highlighted=!1,this.contentElement.classList.remove("highlight")},b.prototype.move=function(a){a.preventDefault();var b=this.getRelativeNode("after");return b&&(this.noHighlight(),b.highlight(),this.app.setCurentNode(b)),!1},b}),define(function(){var a=function(a){this.packages={},this.app=a,this.init()};return a.prototype.init=function(){},a.prototype.add=function(a,b){this.packages[a]=b,$.isFunction(b.init)&&b.init(this.app)},a.prototype.get=function(a){return this.packages[a]},a}),define(function(){var a=function(a){this.app=a};return a.prototype.save=function(){this.saveLocalStorage()},a.prototype.saveLocalStorage=function(){var a=this.app.getRootValue();window.localStorage.setItem("value",JSON.stringify(a))},a}),define(function(){var a=function(a){this.container=document.querySelector(a.container),this.switcherEl=a.switcherEl,this.panelClass=a.panelClass,this.buttonClass=a.buttonClass,this.eventMgr=a.eventMgr,this.init()};return a.prototype.init=function(){var a=this;this.switcherEl.forEach(function(b){a.container.querySelector(b.button).addEventListener("click",function(c){a.switchPanel(b),a.eventMgr.fire("panelChange",{panel:b.name,from:"toolbar"})})})},a.prototype.on=function(a,b,c){this.buttons.push(b);var d=this;c.forEach(function(a){d.container.querySelector(b).addEventListener(a.type,a.callback)})},a.prototype.switchPanel=function(a){if(!(this.currentPanel=a)){var b=a.panel,c=a.button;$(this.panelClass).hide(),$(b).show(),$(this.buttonClass).removeClass("hi"),$(c).addClass("hi"),this.currentPanel=a}},a}),define(function(){var a={};return a.uuid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},a}),define([],function(){}),define(function(a,b,c){var d={name:"editor",extraValue:["editorContent"],node:{},onEvent:{}};d.node._onDomReady=function(){console.log("editor package init");var a=this;this.app.eventMgr.addListener("themeChange",function(b){switch(b){case"dark":b="monokai";break;case"light":b="xq-light"}a.hasLauchEditor&&(a.unLaunchEditor(),a.launchEditor(b))}),this.value.packageValue.editor||(this.value.packageValue.editor={editorContent:""})},d.onEvent=function(a){var b=a.type,c=a.target,d=function(a){a.editorHasLaunched?(a.unLaunchEditor(),a.editorHasLaunched=!1):(a.launchEditor(),a.editorHasLaunched=!0)};return"keydown"==b&&79==a.keyCode&&a.altKey?(a.preventDefault(),d(this),!1):void("click"==b&&a.altKey&&(c==this.buttonElement||c==this.buttonElement.childNodes[0]||c==this.buttonElement.childNodes[0].childNodes[0])&&d())},d.node.editorHasLaunched=!1;var e=function(a){var b;switch(a){case"dark":b="monokai";break;case"light":b="xq-light"}return b};return d.node.launchEditor=function(a){var b=this;this.row.classList.add("package","editor"),this.titleElement=crel("div",{"class":"title",contentEditable:"true"},this.value.content),this.editorElement=crel("div",{"class":"editor"},this.titleElement),this.row.insertBefore(this.editorElement,this.childrenElement);var c=function(a,b,c){var c=c||"xq-light",d={theme:c,tabSize:4,lineNumbers:!1,lineWrapping:!0,autoCloseBrackets:!0,extraKeys:this.keyMaps,mode:{name:"markdown",underscoresBreakWords:!1,taskLists:!0,fencedCodeBlocks:!0},value:b,placeholder:"content..."};return new CodeMirror(a,d)};this.cm=c(this.editorElement,this.value.packageValue.editor.editorContent||"",e(this.app.theme)),this.cm.on("change",function(a,c){b.onEditorContentChange(a,c)}),this.hasLauchEditor=!0,this.focus(this.titleElement)},d.node.unLaunchEditor=function(){$(this.row).removeClass("editor"),this.row.classList.remove("editor"),this.row.removeChild(this.editorElement),this.codemirror=void 0,this.hasLauchEditor=!1},d.node.onEditorContentChange=function(a,b){console.log("change event"),this.editorSave(a.getDoc().getValue()),this.onValueChange()},d.node.editorSave=function(a){this.value.packageValue.editor.editorContent=a},d}),define(function(a,b,c){var d="((https|http|ftp|rtsp|mms)?://)?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?((/?)|(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)",e=(new RegExp(d),{name:"hightlight"});e.init=function(a){a.on("contentChange",function(a){console.log("highlight"+a.value.content)})},c.exports=e});